{% extends "base.html" %} {% block title %}{{ project.name }} - Virsaas Virtual
Software Inc.{% endblock %} {% block content %}
<!-- Enhanced Project Header -->
<div class="mb-8">
  <div class="flex justify-between items-start mb-6">
    <div>
      <h1 class="text-4xl font-bold mb-2">{{ project.name }}</h1>
      <p class="text-xl opacity-75">{{ project.description }}</p>
      <div class="flex items-center space-x-4 mt-4 text-sm">
        <span class="px-3 py-1 rounded-full bg-blue-600 text-white font-bold">
          {{ project.industry }}
        </span>
        <span class="px-3 py-1 rounded-full bg-green-600 text-white font-bold">
          {{ project.business_model }}
        </span>
        <span class="px-3 py-1 rounded-full bg-purple-600 text-white font-bold">
          {{ project.target_market }}
        </span>
      </div>
    </div>
    <div class="flex space-x-2">
      <span
        class="px-3 py-1 rounded text-sm font-bold {% if project.status == 'active' %}bg-green-600{% else %}bg-gray-600{% endif %}"
      >
        {{ project.status.title() }}
      </span>
      <a
        href="{{ url_for('dashboard') }}"
        class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded text-sm font-bold transition-colors"
      >
        <i class="fas fa-arrow-left mr-1"></i>Dashboard
      </a>
    </div>
  </div>

  <!-- Enhanced Project Stats -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    <div class="glass-effect p-4 rounded-lg text-center hover-lift">
      <div class="text-3xl font-bold text-green-400 mb-1">
        {{ project.revenue|format_currency }}
      </div>
      <div class="text-sm opacity-75">Revenue</div>
      <div class="text-xs mt-1 text-green-300">
        +{{ (project.revenue_growth or 12) }}% this week
      </div>
    </div>
    <div class="glass-effect p-4 rounded-lg text-center hover-lift">
      <div class="text-3xl font-bold text-yellow-400 mb-1">
        {{ project.days_elapsed }}
      </div>
      <div class="text-sm opacity-75">Days Elapsed</div>
      <div class="text-xs mt-1 text-yellow-300">
        {{ (project.days_elapsed / 180 * 100)|round(1) }}% complete
      </div>
    </div>
    <div class="glass-effect p-4 rounded-lg text-center hover-lift">
      <div class="text-3xl font-bold text-blue-400 mb-1">
        {{ project.current_phase }}
      </div>
      <div class="text-sm opacity-75">Current Phase</div>
      <div class="text-xs mt-1 text-blue-300">
        {{ project.phase_status or 'On track' }}
      </div>
    </div>
    <div class="glass-effect p-4 rounded-lg text-center hover-lift">
      <div class="text-3xl font-bold text-purple-400 mb-1">25</div>
      <div class="text-sm opacity-75">AI Employees</div>
      <div class="text-xs mt-1 text-purple-300">{{ agents|length }} active</div>
    </div>
  </div>
</div>

<!-- Main Content Grid -->
<div class="grid lg:grid-cols-3 gap-8">
  <!-- Enhanced Virtual Office (2.5D Simulation) -->
  <div class="lg:col-span-2">
    <div class="glass-effect p-6 rounded-lg mb-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">
          <i class="fas fa-building mr-2 text-yellow-400"></i>Virtual Office
          <span class="text-sm font-normal opacity-75 ml-2"
            >32-bit Enhanced Graphics</span
          >
        </h2>
        <div class="flex space-x-2">
          <button
            onclick="toggleSimulation()"
            id="simToggleBtn"
            class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-sm font-bold transition-colors"
          >
            <i class="fas fa-play mr-1"></i>Running
          </button>
          <button
            onclick="resetSimulation()"
            class="bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded text-sm font-bold transition-colors"
          >
            <i class="fas fa-redo mr-1"></i>Reset
          </button>
          <button
            onclick="showOfficeOverview()"
            class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm font-bold transition-colors"
          >
            <i class="fas fa-eye mr-1"></i>Overview
          </button>
        </div>
      </div>

      <!-- Enhanced 2.5D Simulation Viewport -->
      <div class="simulation-viewport" id="simulationViewport">
        <!-- Enhanced Office Layout -->
        <div class="office-background">
          <!-- North Wall -->
          <div
            class="wall-horizontal"
            style="top: 0; left: 0; right: 0; height: 20px"
          ></div>

          <!-- South Wall -->
          <div
            class="wall-horizontal"
            style="bottom: 30px; left: 0; right: 0; height: 20px"
          ></div>

          <!-- West Wall -->
          <div
            class="wall-vertical"
            style="left: 0; top: 20px; bottom: 50px; width: 20px"
          ></div>

          <!-- East Wall -->
          <div
            class="wall-vertical"
            style="right: 0; top: 20px; bottom: 50px; width: 20px"
          ></div>

          <!-- Boardroom -->
          <div
            class="room"
            style="
              left: 300px;
              top: 20px;
              width: 200px;
              height: 100px;
              background: rgba(255, 215, 0, 0.1);
              border: 2px solid #ffd700;
            "
          >
            <div class="room-label">Boardroom</div>
          </div>

          <!-- Development Area -->
          <div
            class="room"
            style="
              left: 50px;
              top: 150px;
              width: 300px;
              height: 200px;
              background: rgba(0, 255, 255, 0.1);
              border: 2px solid #00ffff;
            "
          >
            <div class="room-label" style="color: #00ffff">
              Development Zone
            </div>
          </div>

          <!-- Server Room -->
          <div
            class="room"
            style="
              left: 400px;
              top: 250px;
              width: 150px;
              height: 100px;
              background: rgba(255, 0, 255, 0.1);
              border: 2px solid #ff00ff;
            "
          >
            <div class="room-label" style="color: #ff00ff">Server Room</div>
          </div>

          <!-- Workstations -->
          <div class="workstation" style="left: 80px; top: 180px"></div>
          <div class="workstation" style="left: 160px; top: 180px"></div>
          <div class="workstation" style="left: 240px; top: 180px"></div>
          <div class="workstation" style="left: 80px; top: 260px"></div>
          <div class="workstation" style="left: 160px; top: 260px"></div>
          <div class="workstation" style="left: 240px; top: 260px"></div>

          <!-- Server Racks -->
          <div class="server-rack" style="left: 420px; top: 270px">
            <div class="server-unit" id="server1"></div>
            <div class="server-unit" id="server2"></div>
            <div class="server-unit" id="server3"></div>
            <div class="server-unit" id="server4"></div>
            <div class="server-unit" id="server5"></div>
            <div class="server-unit" id="server6"></div>
            <div class="server-unit" id="server7"></div>
            <div class="server-unit" id="server8"></div>
          </div>

          <!-- Meeting Rooms -->
          <div
            class="meeting-room"
            style="left: 550px; top: 150px; width: 120px; height: 80px"
          ></div>
          <div
            class="meeting-room"
            style="left: 550px; top: 280px; width: 120px; height: 80px"
          ></div>
        </div>

        <!-- Agent Container -->
        <div id="agentContainer"></div>

        <!-- Enhanced LED Ticker -->
        <div class="led-ticker" id="ledTicker">
          <div class="ticker-content" id="tickerText">
            ZTO Inc. - Revenue: $0 - Runway: {{ project.runway_days or 180 }}
            days - Phase: {{ project.current_phase }} - Team: 25 AI Agents
            Active
          </div>
        </div>
      </div>

      <!-- Simulation Controls -->
      <div class="mt-4 flex justify-between items-center text-sm">
        <div class="flex space-x-4">
          <span>Speed: <span id="simSpeed">1x</span></span>
          <span
            >Active Tasks:
            <span id="activeTasks">{{ project.active_tasks or 12 }}</span></span
          >
          <span
            >Build Status:
            <span id="buildStatus" class="text-green-400"
              >{{ project.build_status or 'PASSING' }}</span
            ></span
          >
        </div>
        <div class="flex space-x-2">
          <button
            onclick="changeSpeed(0.5)"
            class="bg-gray-600 hover:bg-gray-700 px-2 py-1 rounded text-xs"
          >
            0.5x
          </button>
          <button
            onclick="changeSpeed(1)"
            class="bg-gray-600 hover:bg-gray-700 px-2 py-1 rounded text-xs"
          >
            1x
          </button>
          <button
            onclick="changeSpeed(2)"
            class="bg-gray-600 hover:bg-gray-700 px-2 py-1 rounded text-xs"
          >
            2x
          </button>
          <button
            onclick="changeSpeed(5)"
            class="bg-gray-600 hover:bg-gray-700 px-2 py-1 rounded text-xs"
          >
            5x
          </button>
        </div>
      </div>
    </div>

    <!-- Enhanced Financial Dashboard -->
    <div class="glass-effect p-6 rounded-lg">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">
          <i class="fas fa-chart-line mr-2 text-green-400"></i>Financial
          Dashboard
        </h2>
        <div class="flex space-x-2">
          <button
            onclick="toggleChartView('revenue')"
            class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-sm font-bold transition-colors"
          >
            Revenue
          </button>
          <button
            onclick="toggleChartView('burn')"
            class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm font-bold transition-colors"
          >
            Burn Rate
          </button>
          <button
            onclick="toggleChartView('runway')"
            class="bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded text-sm font-bold transition-colors"
          >
            Runway
          </button>
        </div>
      </div>
      <div id="financialChart" style="height: 400px"></div>

      <!-- Financial Metrics Grid -->
      <div class="grid grid-cols-3 gap-4 mt-4">
        <div class="text-center">
          <div class="text-2xl font-bold text-green-400" id="monthlyRevenue">
            ${{ project.monthly_revenue or 0 }}
          </div>
          <div class="text-xs opacity-75">Monthly Revenue</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-red-400" id="monthlyBurn">
            ${{ project.monthly_burn or 75000 }}
          </div>
          <div class="text-xs opacity-75">Monthly Burn</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-yellow-400" id="runwayDays">
            {{ project.runway_days or 180 }}
          </div>
          <div class="text-xs opacity-75">Days Runway</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Sidebar -->
  <div class="space-y-6">
    <!-- Enhanced CEO Chat -->
    <div class="glass-effect p-6 rounded-lg">
      <h2 class="text-xl font-bold mb-4">
        <i class="fas fa-comments mr-2 text-blue-400"></i>CEO Chat
        <span class="text-xs font-normal opacity-75 ml-2"
          >AI-Powered Communication</span
        >
      </h2>

      <div
        class="bg-gray-800 rounded-lg p-4 mb-4 h-80 overflow-y-auto"
        id="chatMessages"
      >
        <div class="text-sm text-gray-400 mb-2">
          <i class="fas fa-robot mr-2"></i>
          <strong>CEO-001 (Alex Chen)</strong>
          <div class="text-xs opacity-75">
            {{ project.created_at|format_datetime }}
          </div>
        </div>
        <div class="text-sm mb-4">
          Welcome to your virtual company! I'm your AI CEO. Our team of 25
          specialized agents is ready to bring your vision to life. I can help
          you with strategy, planning, and overseeing the entire development
          process. What would you like to discuss?
        </div>
      </div>

      <div class="flex space-x-2">
        <input
          type="text"
          id="chatInput"
          placeholder="Message your CEO..."
          class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-yellow-400 focus:outline-none text-sm"
        />
        <button
          onclick="sendMessage()"
          class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors"
        >
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>

      <!-- Enhanced Quick Actions -->
      <div class="mt-4 space-y-2">
        <button
          onclick="sendQuickMessage('What is the current project status?')"
          class="w-full text-left text-xs bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded transition-colors"
        >
          <i class="fas fa-chart-bar mr-2"></i>What's our current status?
        </button>
        <button
          onclick="sendQuickMessage('Show me the financial projections')"
          class="w-full text-left text-xs bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded transition-colors"
        >
          <i class="fas fa-dollar-sign mr-2"></i>Financial projections
        </button>
        <button
          onclick="sendQuickMessage('What are the next milestones?')"
          class="w-full text-left text-xs bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded transition-colors"
        >
          <i class="fas fa-flag mr-2"></i>Next milestones
        </button>
        <button
          onclick="sendQuickMessage('Generate business documents')"
          class="w-full text-left text-xs bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded transition-colors"
        >
          <i class="fas fa-file-alt mr-2"></i>Generate documents
        </button>
      </div>
    </div>

    <!-- Enhanced Team Status -->
    <div class="glass-effect p-6 rounded-lg">
      <h2 class="text-xl font-bold mb-4">
        <i class="fas fa-users mr-2 text-purple-400"></i>Team Status
        <span class="text-xs font-normal opacity-75 ml-2"
          >Live Agent Activity</span
        >
      </h2>
      <div id="teamStatus" class="space-y-3 text-sm max-h-64 overflow-y-auto">
        <!-- Team status will be populated by JavaScript -->
      </div>

      <!-- Team Morale Indicator -->
      <div class="mt-4 pt-4 border-t border-gray-600">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm">Team Morale</span>
          <span class="text-sm font-bold" id="teamMoraleValue">92%</span>
        </div>
        <div class="w-full bg-gray-700 rounded-full h-2">
          <div
            class="bg-green-500 h-2 rounded-full transition-all duration-500"
            id="teamMoraleBar"
            style="width: 92%"
          ></div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="glass-effect p-6 rounded-lg">
      <h2 class="text-xl font-bold mb-4">
        <i class="fas fa-history mr-2 text-orange-400"></i>Recent Activity
      </h2>
      <div
        id="recentActivity"
        class="space-y-3 text-sm max-h-48 overflow-y-auto"
      >
        <!-- Recent activity will be populated by JavaScript -->
      </div>
    </div>

    <!-- Development Metrics -->
    <div class="glass-effect p-6 rounded-lg">
      <h2 class="text-xl font-bold mb-4">
        <i class="fas fa-code mr-2 text-cyan-400"></i>Development Metrics
      </h2>
      <div class="space-y-3 text-sm">
        <div class="flex justify-between">
          <span>Code Quality</span>
          <span class="text-green-400">{{ project.code_quality or 94 }}%</span>
        </div>
        <div class="flex justify-between">
          <span>Test Coverage</span>
          <span class="text-blue-400">{{ project.test_coverage or 87 }}%</span>
        </div>
        <div class="flex justify-between">
          <span>Build Success</span>
          <span class="text-green-400">{{ project.build_success or 96 }}%</span>
        </div>
        <div class="flex justify-between">
          <span>Deployment Status</span>
          <span class="text-yellow-400"
            >{{ project.deployment_status or 'STAGED' }}</span
          >
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Agent Detail Modal -->
<div
  id="agentModal"
  class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center"
>
  <div
    class="glass-effect p-8 rounded-lg max-w-4xl w-full mx-4 max-h-screen overflow-y-auto"
  >
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-3xl font-bold" id="agentModalTitle">Agent Details</h2>
      <button
        onclick="closeAgentModal()"
        class="text-gray-400 hover:text-white text-2xl"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="grid md:grid-cols-2 gap-8">
      <!-- Agent Information -->
      <div>
        <h3 class="text-xl font-bold mb-4">Agent Information</h3>
        <div id="agentBasicInfo" class="space-y-3">
          <!-- Basic info will be populated -->
        </div>

        <h3 class="text-xl font-bold mb-4 mt-6">Technical Skills</h3>
        <div id="agentSkills" class="space-y-3">
          <!-- Skills will be populated -->
        </div>

        <h3 class="text-xl font-bold mb-4 mt-6">Current Thought Process</h3>
        <div class="bg-gray-800 p-4 rounded-lg">
          <div id="agentThoughts" class="text-sm italic text-blue-300">
            <!-- Current thoughts will be populated -->
          </div>
        </div>
      </div>

      <!-- Communications & Work History -->
      <div>
        <div class="mb-6">
          <h3 class="text-xl font-bold mb-4">Recent Communications</h3>
          <div
            class="space-y-2 max-h-64 overflow-y-auto"
            id="agentCommunications"
          >
            <!-- Communications will be populated -->
          </div>
        </div>

        <div>
          <h3 class="text-xl font-bold mb-4">Work History</h3>
          <div class="space-y-2 max-h-48 overflow-y-auto" id="agentWorkHistory">
            <!-- Work history will be populated -->
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="mt-6 flex space-x-4">
      <button
        onclick="showComputerDetails()"
        class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded font-bold transition-colors"
      >
        <i class="fas fa-desktop mr-2"></i>View Computer System
      </button>
      <button
        onclick="sendDirectMessage()"
        class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded font-bold transition-colors"
      >
        <i class="fas fa-comment mr-2"></i>Send Message
      </button>
      <button
        onclick="scheduleAgentMeeting()"
        class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded font-bold transition-colors"
      >
        <i class="fas fa-calendar mr-2"></i>Schedule Meeting
      </button>
    </div>
  </div>
</div>

<!-- Enhanced Computer System Modal -->
<div
  id="computerModal"
  class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center"
>
  <div
    class="glass-effect p-8 rounded-lg max-w-6xl w-full mx-4 max-h-screen overflow-y-auto"
  >
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-3xl font-bold">Computer System Details</h2>
      <button
        onclick="closeComputerModal()"
        class="text-gray-400 hover:text-white text-2xl"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="grid md:grid-cols-2 gap-8">
      <!-- System Info -->
      <div>
        <h3 class="text-xl font-bold mb-4">System Information</h3>
        <div class="space-y-3 text-sm" id="systemInfo">
          <!-- System info will be populated -->
        </div>

        <h3 class="text-xl font-bold mb-4 mt-6">Active Processes</h3>
        <div class="space-y-2 max-h-64 overflow-y-auto" id="activeProcesses">
          <!-- Processes will be populated -->
        </div>
      </div>

      <!-- Code View -->
      <div>
        <h3 class="text-xl font-bold mb-4">Current Development</h3>
        <div class="bg-gray-900 p-4 rounded-lg font-mono text-sm">
          <div class="text-green-400 mb-2">// Current Development Session</div>
          <div id="codeView" class="max-h-96 overflow-y-auto">
            <!-- Code will be populated -->
          </div>
        </div>

        <div class="mt-4 flex space-x-2">
          <button
            onclick="toggleCodeView('frontend')"
            class="text-xs bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded"
          >
            Frontend
          </button>
          <button
            onclick="toggleCodeView('backend')"
            class="text-xs bg-green-600 hover:bg-green-700 px-3 py-1 rounded"
          >
            Backend
          </button>
          <button
            onclick="toggleCodeView('database')"
            class="text-xs bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded"
          >
            Database
          </button>
          <button
            onclick="toggleCodeView('devops')"
            class="text-xs bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded"
          >
            DevOps
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Document Generation Modal -->
<div
  id="documentModal"
  class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center"
>
  <div class="glass-effect p-8 rounded-lg max-w-2xl w-full mx-4">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold">Business Documents</h2>
      <button
        onclick="closeDocumentModal()"
        class="text-gray-400 hover:text-white text-2xl"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="space-y-4">
      <div class="bg-gray-800 p-4 rounded-lg">
        <h3 class="font-bold mb-2">
          <i class="fas fa-file-alt mr-2 text-blue-400"></i>Business Plan
        </h3>
        <p class="text-sm opacity-75 mb-2">
          Comprehensive business strategy and market analysis
        </p>
        <button
          onclick="downloadDocument('business_plan')"
          class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm"
        >
          <i class="fas fa-download mr-1"></i>Download
        </button>
      </div>

      <div class="bg-gray-800 p-4 rounded-lg">
        <h3 class="font-bold mb-2">
          <i class="fas fa-gavel mr-2 text-green-400"></i>Terms of Service
        </h3>
        <p class="text-sm opacity-75 mb-2">
          Legal terms and conditions for your platform
        </p>
        <button
          onclick="downloadDocument('terms')"
          class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-sm"
        >
          <i class="fas fa-download mr-1"></i>Download
        </button>
      </div>

      <div class="bg-gray-800 p-4 rounded-lg">
        <h3 class="font-bold mb-2">
          <i class="fas fa-shield-alt mr-2 text-purple-400"></i>Privacy Policy
        </h3>
        <p class="text-sm opacity-75 mb-2">
          Data protection and privacy compliance
        </p>
        <button
          onclick="downloadDocument('privacy')"
          class="bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded text-sm"
        >
          <i class="fas fa-download mr-1"></i>Download
        </button>
      </div>

      <div class="bg-gray-800 p-4 rounded-lg">
        <h3 class="font-bold mb-2">
          <i class="fas fa-handshake mr-2 text-yellow-400"></i>Customer
          Agreement
        </h3>
        <p class="text-sm opacity-75 mb-2">
          Service level agreement and customer terms
        </p>
        <button
          onclick="downloadDocument('agreement')"
          class="bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded text-sm"
        >
          <i class="fas fa-download mr-1"></i>Download
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  // Enhanced simulation variables
  let simulationRunning = true;
  let simulationSpeed = 1;
  let agents = [];
  let selectedAgent = null;
  let currentChartView = 'revenue';
  let project = {{ project|tojson }};

  // Initialize simulation
  function initializeSimulation() {
      loadAgents();
      startSimulationLoop();
      loadProjectStatus();
      initializeFinancialChart();
      updateServerRacks();

      // Update simulation speed display
      document.getElementById('simSpeed').textContent = simulationSpeed + 'x';
  }

  function loadAgents() {
      // Load agent data from the backend
      fetch('/api/project/{{ project.project_id }}/status')
          .then(response => response.json())
          .then(data => {
              agents = data.agents || [];
              createAgentSprites();
              updateTeamStatus();
              updateRecentActivity();
          })
          .catch(error => {
              console.error('Failed to load agents:', error);
              // Create demo agents for fallback
              createDemoAgents();
          });
  }

  function createDemoAgents() {
      const agentPositions = [
          {x: 400, y: 100, color: '#ff6b6b', name: 'CEO-001', role: 'Chief Executive Officer', status: 'thinking'},
          {x: 500, y: 300, color: '#4ecdc4', name: 'DEV-001', role: 'Principal Full-Stack Architect', status: 'coding'},
          {x: 120, y: 200, color: '#45b7d1', name: 'UX-001', role: 'Lead UX Researcher', status: 'researching'},
          {x: 200, y: 200, color: '#96ceb4', name: 'PM-001', role: 'Project Manager', status: 'planning'},
          {x: 280, y: 200, color: '#feca57', name: 'BE-001', role: 'Senior Back-End Engineer', status: 'working'},
          {x: 120, y: 280, color: '#ff9ff3', name: 'FE-001', role: 'Senior Front-End Engineer', status: 'working'},
          {x: 200, y: 280, color: '#54a0ff', name: 'MOB-001', role: 'Senior Mobile Engineer', status: 'testing'},
          {x: 280, y: 280, color: '#5f27cd', name: 'CLOUD-001', role: 'Senior Cloud Engineer', status: 'deploying'},
          {x: 450, y: 350, color: '#00d2d3', name: 'DEVOPS-001', role: 'Senior DevOps / SRE', status: 'monitoring'},
          {x: 600, y: 200, color: '#ff6348', name: 'SEC-001', role: 'Senior Security Engineer', status: 'scanning'}
      ];

      agents = agentPositions.map((pos, index) => ({
          agent_id: pos.name,
          name: pos.name,
          role: pos.role,
          location_x: pos.x,
          location_y: pos.y,
          status: pos.status,
          color: pos.color,
          energy: 95 - (index * 2),
          morale: 92 - (index * 1.5),
          productivity: 88 - (index * 1.2),
          thought_process: getAgentThought(pos.role, pos.status),
          communications: generateAgentCommunications(pos.name, pos.role),
          work_history: generateWorkHistory(pos.name, pos.role)
      }));

      createAgentSprites();
      updateTeamStatus();
      updateRecentActivity();
  }

  function getAgentThought(role, status) {
      const thoughts = {
          'Chief Executive Officer': {
              'thinking': 'Analyzing market trends and strategic opportunities for sustainable growth...',
              'meeting': 'Coordinating with department heads to align our vision and execution...',
              'planning': 'Developing long-term roadmap and resource allocation strategies...'
          },
          'Principal Full-Stack Architect': {
              'coding': 'Implementing microservices architecture with optimal scalability patterns...',
              'working': 'Reviewing code quality and system performance metrics...',
              'thinking': 'Designing database schema and API integration strategies...'
          },
          'Lead UX Researcher': {
              'researching': 'Conducting user interviews and analyzing behavioral patterns...',
              'working': 'Creating wireframes and user journey mapping...',
              'testing': 'Running A/B tests and gathering user feedback metrics...'
          },
          'Project Manager': {
              'planning': 'Organizing sprint planning and resource allocation...',
              'meeting': 'Coordinating cross-functional team communications...',
              'working': 'Tracking project milestones and deliverable timelines...'
          }
      };

      return thoughts[role]?.[status] || 'Processing tasks and optimizing workflow efficiency...';
  }

  function generateAgentCommunications(agentName, role) {
      const comms = [
          `${agentName}: Updated task status in project management system`,
          `${agentName}: Shared insights from latest user research session`,
          `${agentName}: Requested code review from senior developers`,
          `${agentName}: Coordinated with QA team on testing protocols`,
          `${agentName}: Submitted weekly progress report to management`
      ];
      return comms.slice(0, 3);
  }

  function generateWorkHistory(agentName, role) {
      const tasks = [
          `Completed: Frontend component optimization`,
          `In Progress: Database query performance tuning`,
          `Pending: Security audit and vulnerability assessment`,
          `Completed: User interface mockup design`,
          `In Progress: API endpoint documentation`
      ];
      return tasks.slice(0, 4);
  }

  function createAgentSprites() {
      const agentContainer = document.getElementById('agentContainer');
      agentContainer.innerHTML = '';

      agents.forEach(agent => {
          const agentElement = document.createElement('div');
          agentElement.className = 'agent-sprite';
          agentElement.style.left = agent.location_x + 'px';
          agentElement.style.top = agent.location_y + 'px';
          agentElement.style.backgroundColor = agent.color || getRoleColor(agent.role);
          agentElement.title = `${agent.name} - ${agent.role}`;
          agentElement.id = 'agent-' + agent.agent_id;
          agentElement.onclick = () => showAgentDetails(agent.agent_id);

          // Add agent status indicator
          const statusIndicator = document.createElement('div');
          statusIndicator.className = 'agent-status-indicator';
          statusIndicator.style.backgroundColor = getStatusColor(agent.status);
          agentElement.appendChild(statusIndicator);

          // Add hover tooltip
          agentElement.addEventListener('mouseenter', function() {
              showAgentTooltip(agent);
          });

          agentElement.addEventListener('mouseleave', function() {
              hideAgentTooltip();
          });

          agentContainer.appendChild(agentElement);

          // Store element reference
          agent.element = agentElement;
      });
  }

  function getRoleColor(role) {
      const roleColors = {
          'Chief Executive Officer': '#ff6b6b',
          'Principal Full-Stack Architect': '#4ecdc4',
          'Lead UX Researcher': '#45b7d1',
          'Project Manager': '#96ceb4',
          'Senior Back-End Engineer': '#feca57',
          'Senior Front-End Engineer': '#ff9ff3',
          'Senior Mobile Engineer': '#54a0ff',
          'Senior Cloud Engineer': '#5f27cd',
          'Senior DevOps / SRE': '#00d2d3',
          'Senior Security Engineer': '#ff6348'
      };
      return roleColors[role] || '#a4b0be';
  }

  function getStatusColor(status) {
      const statusColors = {
          'working': '#10b981',
          'idle': '#6b7280',
          'meeting': '#f59e0b',
          'thinking': '#8b5cf6',
          'coding': '#06b6d4',
          'testing': '#84cc16',
          'deploying': '#f97316',
          'researching': '#8b5cf6',
          'planning': '#06b6d4',
          'monitoring': '#10b981',
          'scanning': '#ef4444'
      };
      return statusColors[status] || '#6b7280';
  }

  function showAgentTooltip(agent) {
      hideAgentTooltip(); // Remove existing tooltip

      const tooltip = document.createElement('div');
      tooltip.className = 'agent-tooltip';
      tooltip.innerHTML = `
          <div class="font-bold">${agent.name}</div>
          <div class="text-xs opacity-75">${agent.role}</div>
          <div class="text-xs mt-1">Status: <span class="capitalize">${agent.status}</span></div>
          <div class="text-xs">Energy: ${agent.energy || 95}%</div>
          <div class="text-xs italic mt-2">${agent.thought_process || 'Processing tasks...'}</div>
      `;

      // Position tooltip above agent
      const rect = agent.element.getBoundingClientRect();
      const viewport = document.getElementById('simulationViewport').getBoundingClientRect();

      tooltip.style.left = (rect.left - viewport.left + rect.width/2 - 100) + 'px';
      tooltip.style.top = (rect.top - viewport.top - 80) + 'px';

      document.getElementById('simulationViewport').appendChild(tooltip);
  }

  function hideAgentTooltip() {
      const existingTooltip = document.querySelector('.agent-tooltip');
      if (existingTooltip) {
          existingTooltip.remove();
      }
  }

  function startSimulationLoop() {
      if (!simulationRunning) return;

      setInterval(() => {
          if (!simulationRunning) return;

          // Update agent positions
          agents.forEach(agent => {
              if (agent.element && Math.random() < 0.1) {
                  // Small random movement
                  const deltaX = (Math.random() - 0.5) * 20;
                  const deltaY = (Math.random() - 0.5) * 20;

                  const newX = Math.max(30, Math.min(750, agent.location_x + deltaX));
                  const newY = Math.max(30, Math.min(520, agent.location_y + deltaY));

                  agent.location_x = newX;
                  agent.location_y = newY;

                  agent.element.style.left = newX + 'px';
                  agent.element.style.top = newY + 'px';

                  // Occasionally update status
                  if (Math.random() < 0.05) {
                      const statuses = ['working', 'thinking', 'coding', 'testing', 'meeting'];
                      agent.status = statuses[Math.floor(Math.random() * statuses.length)];
                      agent.element.querySelector('.agent-status-indicator').style.backgroundColor = getStatusColor(agent.status);
                  }
              }
          });

          // Update server rack activity
          updateServerRacks();

          // Update ticker occasionally
          if (Math.random() < 0.1) {
              updateTicker();
          }

          // Update team status occasionally
          if (Math.random() < 0.05) {
              updateTeamStatus();
          }

      }, 1000 / simulationSpeed);
  }

  function updateServerRacks() {
      for (let i = 1; i <= 8; i++) {
          const server = document.getElementById('server' + i);
          if (server) {
              const usage = Math.random() * 100;
              const intensity = Math.floor(usage * 2.55);
              server.style.backgroundColor = `rgb(${Math.max(0, 255 - intensity)}, ${intensity}, 0)`;

              // Update tooltip
              const cpu = Math.floor(usage);
              const memory = Math.floor(Math.random() * 100);
              server.title = `CPU: ${cpu}% | Memory: ${memory}% | Temperature: ${Math.floor(35 + usage * 0.3)}Â°C`;
          }
      }
  }

  function updateTicker() {
      const ticker = document.getElementById('tickerText');
      const messages = [
          `ZTO Inc. - Revenue: ${{ project.revenue or 0 }} - Runway: ${{ project.runway_days or 180 }} days - Phase: ${{ project.current_phase }}`,
          `DEV-001: Optimizing database queries for ${{ project.name }}`,
          `UX-001: Conducting user research for ${{ project.target_market }} segment`,
          `PM-001: Planning next sprint with ${{ agents|length }} active agents`,
          `QA-001: Automated tests passing at ${{ project.test_coverage or 87 }}% success rate`,
          `CEO-001: Board meeting scheduled to review ${{ project.business_model }} strategy`,
          `ADMIN-002: Financial projections updated for Q4 planning`,
          `DEV-005: Cloud infrastructure scaling for expected growth`,
          `UX-002: New UI mockups ready for ${{ project.industry }} standards`,
          `DEV-010: Security audit completed with A+ rating`
      ];

      if (Math.random() < 0.1) {
          ticker.textContent = messages[Math.floor(Math.random() * messages.length)];
      }

      // Animate ticker
      const tickerContent = ticker.parentElement;
      tickerContent.style.transform = 'translateX(-10px)';
      setTimeout(() => {
          tickerContent.style.transform = 'translateX(0)';
      }, 100);
  }

  function updateTeamStatus() {
      const statusContainer = document.getElementById('teamStatus');

      if (agents.length === 0) {
          statusContainer.innerHTML = '<div class="text-center opacity-50">Loading team status...</div>';
          return;
      }

      const statusHTML = agents.slice(0, 8).map(agent => {
          const statusColor = getStatusColor(agent.status);
          return `
              <div class="flex justify-between items-center p-3 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors cursor-pointer"
                   onclick="showAgentDetails('${agent.agent_id || agent.name}')">
                  <div>
                      <div class="font-bold text-sm">${agent.name || agent.agent_id}</div>
                      <div class="text-xs opacity-75">${agent.role || 'Developer'}</div>
                      <div class="text-xs text-blue-300 italic mt-1">${agent.thought_process ? agent.thought_process.substring(0, 40) + '...' : 'Processing...'}</div>
                  </div>
                  <div class="flex items-center space-x-2">
                      <div class="w-3 h-3 rounded-full" style="background-color: ${statusColor}"></div>
                      <span class="text-xs capitalize">${agent.status || 'working'}</span>
                  </div>
              </div>
          `;
      }).join('');

      statusContainer.innerHTML = statusHTML;

      // Update team morale
      const morale = Math.floor(Math.random() * 20) + 85; // 85-105%
      document.getElementById('teamMoraleValue').textContent = morale + '%';
      document.getElementById('teamMoraleBar').style.width = Math.min(morale, 100) + '%';
  }

  function updateRecentActivity() {
      const activityContainer = document.getElementById('recentActivity');

      const activities = [
          `${new Date().toLocaleTimeString()}: Code deployment to staging environment`,
          `${new Date().toLocaleTimeString()}: User research session completed`,
          `${new Date().toLocaleTimeString()}: Security scan performed - no issues found`,
          `${new Date().toLocaleTimeString()}: Performance optimization deployed`,
          `${new Date().toLocaleTimeString()}: Team standup meeting completed`
      ];

      const activityHTML = activities.map(activity => `
          <div class="text-xs p-2 bg-gray-800 rounded hover:bg-gray-700 transition-colors">
              ${activity}
          </div>
      `).join('');

      activityContainer.innerHTML = activityHTML;
  }

  function showAgentDetails(agentId) {
      selectedAgent = agents.find(a => (a.agent_id || a.name) === agentId);
      if (!selectedAgent) return;

      // Enhanced agent details display
      document.getElementById('agentModalTitle').textContent = `${selectedAgent.name} - ${selectedAgent.role}`;

      // Basic info
      const basicInfo = `
          <div class="space-y-3">
              <div><strong>ID:</strong> ${selectedAgent.agent_id}</div>
              <div><strong>Role:</strong> ${selectedAgent.role}</div>
              <div><strong>Status:</strong> <span class="px-2 py-1 rounded text-xs" style="background-color: ${getStatusColor(selectedAgent.status)}">${selectedAgent.status}</span></div>
              <div><strong>Energy:</strong> ${selectedAgent.energy || 95}%</div>
              <div><strong>Morale:</strong> ${selectedAgent.morale || 92}%</div>
              <div><strong>Productivity:</strong> ${selectedAgent.productivity || 88}%</div>
              <div><strong>Last Active:</strong> ${new Date().toLocaleTimeString()}</div>
          </div>
      `;
      document.getElementById('agentBasicInfo').innerHTML = basicInfo;

      // Skills
      let skillsHTML = '<div class="space-y-3">';
      if (selectedAgent.technical_skills) {
          skillsHTML += '<div><strong>Technical Skills:</strong><div class="mt-2 space-y-1">';
          Object.entries(selectedAgent.technical_skills).forEach(([skill, level]) => {
              skillsHTML += `
                  <div class="flex justify-between items-center">
                      <span class="text-sm">${skill}</span>
                      <div class="flex-1 mx-2 bg-gray-700 rounded-full h-2">
                          <div class="bg-blue-500 h-2 rounded-full" style="width: ${level}%"></div>
                      </div>
                      <span class="text-xs">${level}%</span>
                  </div>
              `;
          });
          skillsHTML += '</div></div>';
      } else {
          // Demo skills
          const demoSkills = {
              'JavaScript': 95,
              'React': 88,
              'Node.js': 92,
              'Python': 85,
              'Database Design': 90
          };

          skillsHTML += '<div><strong>Technical Skills:</strong><div class="mt-2 space-y-1">';
          Object.entries(demoSkills).forEach(([skill, level]) => {
              skillsHTML += `
                  <div class="flex justify-between items-center">
                      <span class="text-sm">${skill}</span>
                      <div class="flex-1 mx-2 bg-gray-700 rounded-full h-2">
                          <div class="bg-blue-500 h-2 rounded-full" style="width: ${level}%"></div>
                      </div>
                      <span class="text-xs">${level}%</span>
                  </div>
              `;
          });
          skillsHTML += '</div></div>';
      }
      skillsHTML += '</div>';
      document.getElementById('agentSkills').innerHTML = skillsHTML;

      // Current thoughts
      document.getElementById('agentThoughts').textContent = selectedAgent.thought_process || getAgentThought(selectedAgent.role, selectedAgent.status);

      // Communications
      const communicationsHTML = (selectedAgent.communications || generateAgentCommunications(selectedAgent.name, selectedAgent.role))
          .map(comm => `
              <div class="text-xs p-2 bg-gray-800 rounded hover:bg-gray-700 transition-colors">
                  <div class="opacity-75">${new Date().toLocaleTimeString()}</div>
                  <div>${comm}</div>
              </div>
          `).join('');
      document.getElementById('agentCommunications').innerHTML = communicationsHTML;

      // Work history
      const workHistoryHTML = (selectedAgent.work_history || generateWorkHistory(selectedAgent.name, selectedAgent.role))
          .map(work => `
              <div class="text-xs p-2 bg-gray-800 rounded hover:bg-gray-700 transition-colors">
                  ${work}
              </div>
          `).join('');
      document.getElementById('agentWorkHistory').innerHTML = workHistoryHTML;

      document.getElementById('agentModal').classList.remove('hidden');
  }

  function closeAgentModal() {
      document.getElementById('agentModal').classList.add('hidden');
  }

  function showComputerDetails() {
      if (!selectedAgent) return;

      // System info
      const systemInfo = `
          <div class="space-y-3">
              <div><strong>Agent:</strong> ${selectedAgent.name}</div>
              <div><strong>System:</strong> ZTO-Enterprise-Cloud-v2.1</div>
              <div><strong>CPU:</strong> Intel Xeon E5-2686 v4 (16 cores)</div>
              <div><strong>RAM:</strong> 64GB DDR4-2400</div>
              <div><strong>Storage:</strong> 2TB NVMe SSD</div>
              <div><strong>GPU:</strong> NVIDIA Tesla V100 16GB</div>
              <div><strong>OS:</strong> Ubuntu 20.04 LTS</div>
              <div><strong>Runtime:</strong> Node.js 18.x, Python 3.9</div>
          </div>
      `;
      document.getElementById('systemInfo').innerHTML = systemInfo;

      // Active processes
      const processes = [
          {name: 'code_analysis_' + selectedAgent.name.toLowerCase(), cpu: '12%', memory: '2.3GB', pid: Math.floor(Math.random() * 9000) + 1000},
          {name: 'test_runner', cpu: '8%', memory: '1.1GB', pid: Math.floor(Math.random() * 9000) + 1000},
          {name: 'git_operations', cpu: '3%', memory: '0.2GB', pid: Math.floor(Math.random() * 9000) + 1000},
          {name: 'docker_container', cpu: '15%', memory: '4.2GB', pid: Math.floor(Math.random() * 9000) + 1000},
          {name: 'monitoring_agent', cpu: '1%', memory: '0.1GB', pid: Math.floor(Math.random() * 9000) + 1000}
      ];

      const processesHTML = processes.map(proc => `
          <div class="flex justify-between items-center p-2 bg-gray-800 rounded text-xs">
              <div class="flex-1 font-mono">${proc.name}</div>
              <div class="flex space-x-4">
                  <span>CPU: ${proc.cpu}</span>
                  <span>RAM: ${proc.memory}</span>
                  <span>PID: ${proc.pid}</span>
              </div>
          </div>
      `).join('');
      document.getElementById('activeProcesses').innerHTML = processesHTML;

      // Code view
      updateCodeView('frontend');

      document.getElementById('computerModal').classList.remove('hidden');
  }

  function closeComputerModal() {
      document.getElementById('computerModal').classList.add('hidden');
  }

  function updateCodeView(type) {
      const codeViews = {
          frontend: `
              <div class="text-gray-400">// Current Development Session</div>
              <div class="text-blue-400">import</div> <div class="text-white">React, { useState, useEffect }</div> <div class="text-blue-400">from</div> <div class="text-orange-400">'react'</div>;
              <div class="text-blue-400">import</div> <div class="text-white">axios</div> <div class="text-blue-400">from</div> <div class="text-orange-400">'axios'</div>;
              <br>
              <div class="text-blue-400">const</div> <div class="text-yellow-400">DashboardComponent</div> = ({ <div class="text-white">projectId</div> }) => {
              <div class="text-blue-400">const</div> [<div class="text-white">metrics</div>, <div class="text-white">setMetrics</div>] = <div class="text-yellow-400">useState</div>(<div class="text-blue-400">null</div>);
              <br>
              &nbsp;&nbsp;<div class="text-yellow-400">useEffect</div>(() => {
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-yellow-400">fetchMetrics</div>();
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-blue-400">const</div> <div class="text-white">interval</div> = <div class="text-yellow-400">setInterval</div>(<div class="text-white">fetchMetrics</div>, <div class="text-orange-400">5000</div>);
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-blue-400">return</div> () => <div class="text-yellow-400">clearInterval</div>(<div class="text-white">interval</div>);
              &nbsp;&nbsp;}, [<div class="text-white">projectId</div>]);
              <br>
              &nbsp;&nbsp;<div class="text-blue-400">const</div> <div class="text-white">fetchMetrics</div> = <div class="text-blue-400">async</div> () => {
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-blue-400">try</div> {
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="text-blue-400">const</div> <div class="text-white">response</div> = <div class="text-blue-400">await</div> <div class="text-white">axios</div>.<div class="text-yellow-400">get</div>(<div class="text-orange-400">\`/api/project/\${projectId}/metrics\`</div>);
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">setMetrics</div>(<div class="text-white">response</div>.<div class="text-white">data</div>);
              &nbsp;&nbsp;&nbsp;&nbsp;} <div class="text-blue-400">catch</div> (<div class="text-white">error</div>) {
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="text-yellow-400">console</div>.<div class="text-white">error</div>(<div class="text-orange-400">'Failed to fetch metrics:'</div>, <div class="text-white">error</div>);
              &nbsp;&nbsp;&nbsp;&nbsp;}
              &nbsp;&nbsp;};
              <br>
              &nbsp;&nbsp;<div class="text-blue-400">return</div> (
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-gray-400">// Component JSX would go here</div>
              &nbsp;&nbsp;);
              };
              <br>
              <div class="text-blue-400">export default</div> <div class="text-yellow-400">DashboardComponent</div>;
          `,
          backend: `
              <div class="text-gray-400"># Backend API Development</div>
              <div class="text-blue-400">from</div> <div class="text-white">flask</div> <div class="text-blue-400">import</div> <div class="text-white">Flask, jsonify, request</div>
              <div class="text-blue-400">from</div> <div class="text-white">flask_sqlalchemy</div> <div class="text-blue-400">import</div> <div class="text-white">SQLAlchemy</div>
              <div class="text-blue-400">from</div> <div class="text-white">datetime</div> <div class="text-blue-400">import</div> <div class="text-white">datetime</div>
              <br>
              <div class="text-white">app = Flask(__name__)</div>
              <div class="text-white">db = SQLAlchemy(app)</div>
              <br>
              <div class="text-blue-400">class</div> <div class="text-yellow-400">Project</div>(<div class="text-white">db.Model</div>):
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">id = db.Column(db.Integer, primary_key=True)</div>
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">name = db.Column(db.String(100), nullable=False)</div>
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">status = db.Column(db.String(50), default='active')</div>
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">created_at = db.Column(db.DateTime, default=datetime.utcnow)</div>
              <br>
              <div class="text-yellow-400">@app.route</div>(<div class="text-orange-400">'/api/project/<int:project_id>'</div>)
              <div class="text-blue-400">def</div> <div class="text-white">get_project</div>(<div class="text-white">project_id</div>):
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">project = Project.query.get_or_404(project_id)</div>
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-blue-400">return</div> <div class="text-white">jsonify</div>({
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="text-orange-400">'id'</div>: <div class="text-white">project.id</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="text-orange-400">'name'</div>: <div class="text-white">project.name</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="text-orange-400">'status'</div>: <div class="text-white">project.status</div>
              &nbsp;&nbsp;&nbsp;&nbsp;})
          `,
          database: `
              <div class="text-gray-400">-- Database Schema & Queries</div>
              <div class="text-blue-400">CREATE TABLE</div> <div class="text-white">projects</div> (
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">id</div> <div class="text-blue-400">SERIAL PRIMARY KEY</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">name</div> <div class="text-blue-400">VARCHAR</div>(<div class="text-orange-400">100</div>) <div class="text-blue-400">NOT NULL</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">description</div> <div class="text-blue-400">TEXT</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">status</div> <div class="text-blue-400">VARCHAR</div>(<div class="text-orange-400">50</div>) <div class="text-blue-400">DEFAULT</div> <div class="text-orange-400">'active'</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">revenue</div> <div class="text-blue-400">DECIMAL</div>(<div class="text-orange-400">10,2</div>) <div class="text-blue-400">DEFAULT</div> <div class="text-orange-400">0.00</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">created_at</div> <div class="text-blue-400">TIMESTAMP</div> <div class="text-blue-400">DEFAULT</div> <div class="text-white">NOW</div>()
              );
              <br>
              <div class="text-blue-400">CREATE TABLE</div> <div class="text-white">agents</div> (
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">id</div> <div class="text-blue-400">SERIAL PRIMARY KEY</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">name</div> <div class="text-blue-400">VARCHAR</div>(<div class="text-orange-400">50</div>) <div class="text-blue-400">NOT NULL</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">role</div> <div class="text-blue-400">VARCHAR</div>(<div class="text-orange-400">100</div>) <div class="text-blue-400">NOT NULL</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">status</div> <div class="text-blue-400">VARCHAR</div>(<div class="text-orange-400">20</div>) <div class="text-blue-400">DEFAULT</div> <div class="text-orange-400">'active'</div>,
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">project_id</div> <div class="text-blue-400">INTEGER</div> <div class="text-blue-400">REFERENCES</div> <div class="text-white">projects(id)</div>
              );
              <br>
              <div class="text-gray-400">-- Performance optimization queries</div>
              <div class="text-blue-400">CREATE INDEX</div> <div class="text-white">idx_project_status</div> <div class="text-blue-400">ON</div> <div class="text-white">projects(status)</div>;
              <div class="text-blue-400">CREATE INDEX</div> <div class="text-white">idx_agent_project</div> <div class="text-blue-400">ON</div> <div class="text-white">agents(project_id)</div>;
          `,
          devops: `
              <div class="text-gray-400"># DevOps & Infrastructure</div>
              <div class="text-blue-400">version</div>: <div class="text-orange-400">'3.8'</div>
              <br>
              <div class="text-white">services</div>:
              &nbsp;&nbsp;<div class="text-white">web</div>:
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">build</div>: .
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">ports</div>:
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <div class="text-orange-400">"5000:5000"</div>
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">environment</div>:
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <div class="text-white">DATABASE_URL=postgresql://...</div>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <div class="text-white">REDIS_URL=redis://redis:6379</div>
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">depends_on</div>:
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <div class="text-white">db</div>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <div class="text-white">redis</div>
              <br>
              &nbsp;&nbsp;<div class="text-white">db</div>:
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">image</div>: <div class="text-orange-400">postgres:13</div>
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">environment</div>:
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">POSTGRES_DB: zto_enterprise</div>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">POSTGRES_PASSWORD: ${Math.random().toString(36).substring(7)}</div>
              <br>
              &nbsp;&nbsp;<div class="text-white">redis</div>:
              &nbsp;&nbsp;&nbsp;&nbsp;<div class="text-white">image</div>: <div class="text-orange-400">redis:6-alpine</div>
          `
      };

      document.getElementById('codeView').innerHTML = codeViews[type];
  }

  // Other functions remain the same...
  function toggleSimulation() {
      simulationRunning = !simulationRunning;
      const btn = document.getElementById('simToggleBtn');
      if (simulationRunning) {
          btn.innerHTML = '<i class="fas fa-pause mr-1"></i>Running';
          btn.className = 'bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-sm font-bold transition-colors';
      } else {
          btn.innerHTML = '<i class="fas fa-play mr-1"></i>Paused';
          btn.className = 'bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm font-bold transition-colors';
      }
  }

  function resetSimulation() {
      if (confirm('Are you sure you want to reset the simulation? This will restart all progress.')) {
          location.reload();
      }
  }

  function changeSpeed(speed) {
      simulationSpeed = speed;
      document.getElementById('simSpeed').textContent = speed + 'x';
  }

  function sendMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (!message) return;

      addChatMessage('You', message, 'user');
      input.value = '';

      // Send to backend
      fetch('/api/project/{{ project.project_id }}/message', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify({message: message})
      })
      .then(response => response.json())
      .then(data => {
          if (data.success) {
              // Simulate CEO response
              setTimeout(() => {
                  const responses = [
                      `Excellent question! Let me check with our ${{ project.industry }} specialist team.`,
                      `Great insight. I'll have ${agents[Math.floor(Math.random() * agents.length)].name || 'our team'} analyze this further.`,
                      `Thank you for the input. This aligns perfectly with our ${{ project.business_model }} strategy.`,
                      `I understand your concern. Let me schedule a meeting with the relevant departments.`,
                      `That's a valuable perspective. I'll incorporate this into our development roadmap.`,
                      `Excellent suggestion! This will help us better serve the ${{ project.target_market }} market.`,
                      `I appreciate your feedback. Our AI team will process this information immediately.`,
                      `That's a strategic approach. Let me review our current priorities and resources.`
                  ];

                  const response = responses[Math.floor(Math.random() * responses.length)];
                  addChatMessage('CEO-001 (Alex Chen)', response, 'agent');
              }, 1000 + Math.random() * 2000);
          }
      })
      .catch(error => {
          showNotification('Failed to send message', 'error');
      });
  }

  function sendQuickMessage(message) {
      document.getElementById('chatInput').value = message;
      sendMessage();
  }

  function addChatMessage(sender, message, type) {
      const chatContainer = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `mb-3 ${type === 'user' ? 'text-right' : 'text-left'}`;

      const messageClass = type === 'user' ? 'bg-blue-600' : 'bg-gray-600';
      const icon = type === 'user' ? 'fas fa-user' : 'fas fa-robot';

      messageDiv.innerHTML = `
          <div class="inline-block ${messageClass} px-4 py-2 rounded-lg text-sm max-w-xs text-left">
              <div class="flex items-center space-x-2 mb-1">
                  <i class="${icon} text-xs"></i>
                  <span class="font-bold">${sender}</span>
                  <span class="text-xs opacity-75">${new Date().toLocaleTimeString()}</span>
              </div>
              <div class="text-sm">${message}</div>
          </div>
      `;

      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  function generateDocuments() {
      showNotification('Generating comprehensive business documents...', 'info');

      fetch('/api/project/{{ project.project_id }}/generate_documents', {
          method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
          if (data.success) {
              showNotification('Documents generated successfully! Check the output folder.', 'success');
              document.getElementById('documentModal').classList.remove('hidden');
          } else {
              showNotification(data.error || 'Failed to generate documents', 'error');
          }
      })
      .catch(error => {
          showNotification('Failed to generate documents', 'error');
      });
  }

  function closeDocumentModal() {
      document.getElementById('documentModal').classList.add('hidden');
  }

  function downloadDocument(type) {
      showNotification(`Downloading ${type} document...`, 'info');

      fetch(`/api/project/{{ project.project_id }}/download_document/${type}`)
          .then(response => response.blob())
          .then(blob => {
              const url = window.URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.style.display = 'none';
              a.href = url;
              a.download = `${type}_${project.name.replace(/\s+/g, '_')}.pdf`;
              document.body.appendChild(a);
              a.click();
              window.URL.revokeObjectURL(url);
              showNotification(`${type} document downloaded successfully!`, 'success');
          })
          .catch(error => {
              showNotification('Failed to download document', 'error');
          });
  }

  function showOfficeOverview() {
      showNotification('Office overview feature coming soon!', 'info');
      addChatMessage('CEO-001 (Alex Chen)',
          'Great idea! An office overview would show you the complete layout, team distribution, and real-time productivity metrics. I\'ll have our UX team prioritize this feature.',
          'agent');
  }

  function sendDirectMessage() {
      if (!selectedAgent) return;

      const message = prompt(`Send a direct message to ${selectedAgent.name}:`);
      if (message) {
          showNotification(`Message sent to ${selectedAgent.name}`, 'success');
          addChatMessage('You', `To ${selectedAgent.name}: ${message}`, 'user');

          setTimeout(() => {
              addChatMessage(selectedAgent.name, `Received your message. I'll process this and get back to you.`, 'agent');
          }, 1500);
      }
  }

  function scheduleAgentMeeting() {
      if (!selectedAgent) return;

      showNotification(`Meeting request sent to ${selectedAgent.name}`, 'info');
      addChatMessage(selectedAgent.name,
          `I'd be happy to schedule a meeting. Please use the calendar integration feature or contact me directly through our project management system.`,
          'agent');
  }

  function showNotification(message, type) {
      // Simple notification system
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 p-4 rounded-lg z-50 ${
          type === 'success' ? 'bg-green-600' :
          type === 'error' ? 'bg-red-600' :
          type === 'info' ? 'bg-blue-600' : 'bg-gray-600'
      }`;
      notification.textContent = message;

      document.body.appendChild(notification);

      setTimeout(() => {
          notification.remove();
      }, 3000);
  }

  // Initialize when page loads
  document.addEventListener('DOMContentLoaded', function() {
      initializeSimulation();
  });
</script>

<!-- Link to enhanced CSS -->
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/enterprise_2d5.css') }}"
/>
{% endblock %}
