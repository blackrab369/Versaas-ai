{% extends "base.html" %} {% block title %}Login - Virsaas Virtual Software
Inc.{% endblock %}

<!-- add inside login.html, just above the old form -->
<section class="magic-login">
  <h3>Continue with Email</h3>
  <input type="email" id="email-input" placeholder="you@example.com" required />
  <button id="send-magic" class="btn-primary">Send Magic Link</button>
  <p id="magic-status"></p>
</section>

<script>
  document.getElementById("send-magic").onclick = async () => {
    const email = document.getElementById("email-input").value;
    const status = document.getElementById("magic-status");
    status.textContent = "Sendingâ€¦";
    const res = await fetch("/login/email", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email }),
    });
    const data = await res.json();
    status.textContent = data.success
      ? "Check your inbox / logs for the magic link."
      : data.error;
  };
</script>

{% block content %}
<div class="max-w-md mx-auto">
  <div class="glass-effect p-8 rounded-lg">
    <div class="text-center mb-8">
      <i class="fas fa-sign-in-alt text-4xl text-yellow-400 mb-4"></i>
      <h1 class="text-2xl font-bold">Welcome Back</h1>
      <p class="text-sm opacity-75 mt-2">Login to your virtual company</p>
    </div>

    <!-- Social Login -->
    <div class="grid grid-cols-2 gap-4 mb-6">
      <a href="{{ url_for('login_google') }}"
        class="flex items-center justify-center bg-white text-gray-900 py-2 rounded-lg hover:bg-gray-100 transition-colors">
        <i class="fab fa-google mr-2 text-red-500"></i> Google
      </a>
      <a href="{{ url_for('login_github') }}"
        class="flex items-center justify-center bg-gray-700 text-white py-2 rounded-lg hover:bg-gray-600 transition-colors">
        <i class="fab fa-github mr-2"></i> GitHub
      </a>
    </div>

    <div class="relative mb-6">
      <div class="absolute inset-0 flex items-center">
        <div class="w-full border-t border-gray-600"></div>
      </div>
      <div class="relative flex justify-center text-sm">
        <span class="px-2 bg-gray-900 text-gray-400">Or continue with</span>
      </div>
    </div>


    <form id="loginForm" class="space-y-6">
      <div>
        <label class="block text-sm font-medium mb-2">Username</label>
        <input type="text" id="username" name="username" required
          class="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:border-yellow-400 focus:outline-none" />
      </div>

      <div>
        <label class="block text-sm font-medium mb-2">Password</label>
        <input type="password" id="password" name="password" required
          class="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:border-yellow-400 focus:outline-none" />
      </div>

      <div class="flex items-center justify-between">
        <label class="flex items-center">
          <input type="checkbox" name="remember"
            class="w-4 h-4 text-yellow-400 bg-gray-800 border-gray-600 rounded focus:ring-yellow-400" />
          <span class="ml-2 text-sm">Remember me</span>
        </label>
        <a href="#" class="text-sm text-yellow-400 hover:underline">Forgot password?</a>
      </div>

      <button type="submit"
        class="w-full bg-yellow-600 hover:bg-yellow-700 py-3 rounded-lg font-bold transition-colors">
        <i class="fas fa-sign-in-alt mr-2"></i>Login
      </button>
    </form>

    <div class="mt-6 text-center">
      <p class="text-sm opacity-75">
        Don't have an account?
        <a href="{{ url_for('register') }}" class="text-yellow-400 hover:underline">Register here</a>
      </p>
    </div>

    <!-- Demo Credentials -->
    <div class="mt-8 p-4 bg-gray-800 rounded-lg">
      <h3 class="text-sm font-bold mb-2 text-center">Demo Account</h3>
      <div class="text-xs space-y-1">
        <p><strong>Username:</strong> demo</p>
        <p><strong>Password:</strong> demo123</p>
      </div>
      <button
        onclick="document.getElementById('username').value='demo'; document.getElementById('password').value='demo123';"
        class="w-full mt-3 bg-blue-600 hover:bg-blue-700 py-2 rounded text-sm transition-colors">
        Use Demo Account
      </button>
    </div>
  </div>
</div>

<script>
  document
    .getElementById("loginForm")
    .addEventListener("submit", async function (e) {
      e.preventDefault();

      const formData = new FormData(this);

      try {
        const response = await fetch('{{ url_for("login") }}', {
          method: "POST",
          body: formData,
        });

        const result = await response.json();

        if (result.success) {
          showNotification(
            "Login successful! Redirecting to dashboard...",
            "success"
          );
          setTimeout(() => {
            window.location.href = result.redirect;
          }, 1500);
        } else {
          showNotification(result.error, "error");
        }
      } catch (error) {
        showNotification("Login failed. Please try again.", "error");
      }
    });
</script>
{% endblock %}
<style>
  :root {
    --primary: {
        {
        custom_colour
      }
    }

    !important;
  }
</style>
{% if agency %}<img src="{{ custom_logo }}" height="32">{% else %}Virsaas{% endif %}